{
	"nodes":[
		{"id":"9462d273d28b33f1","type":"group","x":-1840,"y":-4500,"width":2760,"height":1980,"color":"#ae6bff","label":"Code Structure"},
		{"id":"175aa85f3cca83bc","type":"group","x":-2880,"y":-1920,"width":3400,"height":1373,"label":"Relevant Pages"},
		{"id":"c664666e2ac3bca7","type":"group","x":1040,"y":-4500,"width":1520,"height":1980,"color":"2","label":"Classes"},
		{"id":"2ad02c6a646a8021","type":"text","text":"# Storing files\nThe subject mentions configuring the storage locations for files clients might send. For nginx, this is actually handled by CGI scripts in the backend; but for us, this is going to be handled by the server itself.","x":-280,"y":-2360,"width":440,"height":321,"color":"4"},
		{"id":"af0d87420fe337bf","type":"text","text":"# `Connection`\nRepresents an active connection from a client.\n## Member Functions\n\n## Data Members\n","x":1120,"y":-3880,"width":761,"height":797},
		{"id":"02c2072a17f2e4f4","type":"text","text":"# `Request`\nRepresents a request issued by an active connection.\n## Member Functions\nExposes `process()`, which will call the right next step in the request sequence of processing:\n1. `parse()`\n2. `get_content()` or\n3. `launch_cgi()`\n\n## Data Members\n","x":1120,"y":-4440,"width":571,"height":490},
		{"id":"6e9d8415dc547c2d","type":"text","text":"# `epoll` or `poll`\n`epoll` is clearly the wayyy better option, but it comes with a caveat of not being portable outside of Linux.\nTo be honest, I think it's a good plan to use `epoll` instead of `poll`; we're not going to test webserv on macos anyways.\nAnd who even runs web servers on macos/windows nowadays?","x":-2560,"y":-3240,"width":480,"height":360,"color":"2"},
		{"id":"f7783e0a9eb791d2","type":"text","text":"# Config File\n> Directives are divided into simple directives and block directives. A simple directive consists of the name and parameters separated by spaces and ends with a semicolon (`;`). A block directive has the same structure as a simple directive, but instead of the semicolon it ends with a set of additional instructions surrounded by braces (`{` and `}`). If a block directive can have other directives inside braces, it is called a context (examples: [events](https://nginx.org/en/docs/ngx_core_module.html#events), [http](https://nginx.org/en/docs/http/ngx_http_core_module.html#http), [server](https://nginx.org/en/docs/http/ngx_http_core_module.html#server), and [location](https://nginx.org/en/docs/http/ngx_http_core_module.html#location)).\n> Directives placed in the configuration file outside of any contexts are considered to be in the [main](https://nginx.org/en/docs/ngx_core_module.html) context. The `events` and `http` directives reside in the `main` context, `server` in `http`, and `location` in `server`.\n> The rest of a line after the `#` sign is considered a comment.[^1]\n\nOur config file for webserv should be directly based on nginx's config file format. Each instruction must have the same name as in nginx if present, and the structure must match nginx's as closely as possible. Obviously **we won't implement every feature** of every instruction.\n**Optionals/nice to haves are in italic.**\n- *[`error_log`](https://nginx.org/en/docs/ngx_core_module.html#error_log)*: Defines a file to redirect all error messages to, with potentially log levels? Would need to see how that translates in code\n- [`http {}`](https://nginx.org/en/docs/http/ngx_http_core_module.html#http)\n\t- [`server {}`](https://nginx.org/en/docs/http/ngx_http_core_module.html#server)\n\t\t- [`listen`](https://nginx.org/en/docs/http/ngx_http_core_module.html#listen): Defines the interface AND port to listen on\n\t\t- [`error_page`](https://nginx.org/en/docs/http/ngx_http_core_module.html#error_page): Sets default error pages for given HTTP error codes\n\t\t- [`client_max_body_size`](https://nginx.org/en/docs/http/ngx_http_core_module.html#client_max_body_size): Maximum allowed size for client request bodies in bytes\n\t\t- [`location {}`](https://nginx.org/en/docs/http/ngx_http_core_module.html#location) (without any of the modifiers)\n\t\t\t- [`limit_except {}`](https://nginx.org/en/docs/http/ngx_http_core_module.html#limit_except): Allow/deny specific HTTP methods for a location\n\t\t\t- [`return`](https://nginx.org/en/docs/http/ngx_http_rewrite_module.html#return): Define HTTP redirections and status code for those redirections\n\t\t\t- [`root`](https://nginx.org/en/docs/http/ngx_http_core_module.html#root): Defines the root of the location\n\t\t\t- [`autoindex`](https://nginx.org/en/docs/http/ngx_http_autoindex_module.html#autoindex): Bool for enabling directory listings\n\t\t\t- [`index`](https://nginx.org/en/docs/http/ngx_http_index_module.html#index): Default file to serve \n\t\t\t- `upload_store`: Enables uploads by its presence and defines where uploaded files should go (this is custom and not present in nginx)\n\t\t\t- `cgi {}`: (this is custom and not present in nginx)\n\t\t\t\t- `language`: A string identifying which language will be used, mainly useful to differentiate between multiple `cgi` blocks (a bit like an ID)\n\t\t\t\t- `interpreter`: Path to the interpreter that will execute the script for this CGI language\n\t\t\t\t- **Something else?**\n\n## Optional Config\nThis is for elements that could be useful but aren't expected by the subject exactly.\n\n\n[^1]: https://nginx.org/en/docs/beginners_guide.html\n","x":-2984,"y":-4964,"width":848,"height":1140,"color":"5"},
		{"id":"8653170cc585fd0e","type":"file","file":"Computer Science/Networking/HyperText Transfer Protocol.md","x":-2003,"y":-1879,"width":963,"height":1312},
		{"id":"77a7d841da8ee77f","type":"text","text":"\n# Resources\n## RFCs\n- RFC [1945](https://www.rfc-editor.org/rfc/rfc1945) - The HTTP 1.0 standard, for the core functionality of HTTP, the *how it works*, not *what it means* (the semantics).\n- RFC [9112](https://www.rfc-editor.org/rfc/rfc9112) - The HTTP 1.1 standard, for when we need to implement 1.1 specific features.\n- RFC [9110](https://www.rfcreader.com/#rfc9110) - Provides a more recent covering of all HTTP semantics, and as such **obsoletes a whole lot of older RFCs, including the 72XX ones**.\n## Other Resources\n- [A Simple HTTP Server from Scratch](https://trungams.github.io/2020-08-23-a-simple-http-server-from-scratch/) - Example of a basic web server using sockets and c++ 98","x":-2760,"y":-1822,"width":620,"height":562},
		{"id":"244b7e4837cb2d96","x":-980,"y":-1871,"width":940,"height":1304,"type":"file","file":"Computer Science/Networking/Common Gateway Interface.md"},
		{"id":"26d337a6c3ac2719","type":"text","text":"# Subject PDF notes\n- The requirement about not checking `errno` after read/write operations probably relates to the fact that `-1` as a return value **doesn't always mean an error** if errno is `EAGAIN` or `EWOULDBLOCK`.\n- `poll` or equivalent means: `poll`, `epoll`, `select`\n- `epoll` is basically `poll` but better and least portable; might be useful if we make our webserv only usable on Linux, which I think we should but is up to debate\n- Obviously we only have to use non-blocking IO in the case of network stuff, local read/writes are exempt\n- ","x":-2760,"y":-1219,"width":624,"height":652},
		{"id":"359680b1fa8c1bac","type":"text","text":"# CGI\nGenerates content dynamically based on the standardized request passed by the Request Processor.\n> `fork`, `execve`, `pipe`, `dup`, `dup2`\n## Responsibilities\nForks the right CGI script based on the request, and sends back the read end of the pipe for the generated content.\nAll subprocess magic must happen here.\nThe CGI script would give the content back through a pipe.\n\n> python and ruby","x":420,"y":-3220,"width":460,"height":470,"color":"6"},
		{"id":"a3f2aa91b73d8bba","type":"text","text":"# Request Parser\nReceives raw requests from the Request Processor, parses it into a class/struct instance and returns it for processing.\n## Stages\nEach request being parsed needs to go through different stages (as chunks of bytes from `recv` come through): parsing the request line -> headers -> body -> request is done.","x":270,"y":-4300,"width":380,"height":380,"color":"5"},
		{"id":"315051fc1e32883d","x":-478,"y":-4275,"width":478,"height":255,"color":"1","type":"text","text":"# Disclaimer\n## ***This graph isn't ready at all yet, it's still very much in progress.***\nDon't base yourself only on this to understand the structure of what webserv will be like, yet."},
		{"id":"1056644817197069","type":"text","text":"# Request Processor\nThe Request Processor is responsible for making the state of requests progress, step by step.\nThe state (progress of the request) is stored as part of the class, and a `process()` member functions calls the appropriate next step.","x":-480,"y":-3790,"width":560,"height":640,"color":"1"},
		{"id":"7030fb2be992c307","type":"text","text":"# File Manager\nAll file-related functions are managed here (except CGI).\n> `opendir`, `readdir`, `closedir`, `open`, `close`, `read`, `write`, `access`, `stat`\n## Responsibilities\n1. Get files for the Request Processor\n2. Store files of POST requests\n3. Create directory listings when Request Processor asks for it","x":-280,"y":-2920,"width":540,"height":340,"color":"4"},
		{"id":"e2202cc847dfb53f","type":"text","text":"# Configuration Parser\n## Responsibilities\nParses the configuration file once at the start of the program and stores the configuration for later use.\nWhen prompted, provides all configuration in nice array for all routes available in the config, as well as a global configuration\n## Structure of the Config\nI'd imagine the configuration to be represented in code as a class `Config` which stores all global configuration, as well as individual, route configurations (directory, redirection, methods, etc...)\nFor nginx, there are **servers** that contain **locations**. The servers define **the port it will listen on**, and the locations **where to fetch files on the host based on the URI**.","x":-1800,"y":-4460,"width":520,"height":514,"color":"5"},
		{"id":"6a5e75190ad0c3a1","type":"text","text":"# Connection Manager\n**The main event loop**. Essentially, it's here for routing requests and responses to clients.\nCould be part of the main function directly or executed as part of another function.\n> `socket`, `send`, `recv`, `bind`, `connect`, `listen`, `accept`, `poll`, `epoll`, `kevent`, `htons`, `htonl`, `ntohs`, `noths`\n## Responsibilities\nReceives incoming connections and manages existing ones.\nMaps `Connection` objects to `Request` objects (`Connection` contains `Request`? Maybe `vector<Request>`) according to the configuration.\nSends incoming requests to the Request Processor in raw form.\nReceives the requested data back from the Request Processor and sends them to the relevant socket\nThis is where all the sockets fun happens: `poll`, `accept` and `send`.\nThe loop polls all active sockets, as well as CGI fds to read the content from and send it to the client that requested it.","x":-1600,"y":-3240,"width":500,"height":660,"color":"2"},
		{"id":"01bed0363669d98c","type":"text","text":"# Driver\nThis is the main function\n> `access`, `stat`, `open`, `close`\n## Responsibilities\n1. Do basic checks for config file access, then call the Parser.\n2. Create the Connection Manager with its individual Listeners (?)\n3. Start the Connection Manager event loop\n4. When the event loop stops, check for any errors (exception, return value) and clean up before exiting.","x":-1100,"y":-3820,"width":440,"height":440,"color":"3"}
	],
	"edges":[
		{"id":"6f9277e443cbed01","fromNode":"01bed0363669d98c","fromSide":"left","toNode":"e2202cc847dfb53f","toSide":"right","label":"<- Ask for configuration parsing\nReturns a `Config` object ->"},
		{"id":"0b27ad5388fb9eec","fromNode":"e2202cc847dfb53f","fromSide":"right","toNode":"01bed0363669d98c","toSide":"left"},
		{"id":"65f20bf9a0f68212","fromNode":"01bed0363669d98c","fromSide":"bottom","toNode":"6a5e75190ad0c3a1","toSide":"top","label":"main starts the event loop\nonce the config is ready"},
		{"id":"3e23928a268d73c6","fromNode":"1056644817197069","fromSide":"right","toNode":"a3f2aa91b73d8bba","toSide":"bottom","label":"TO CHANGE\nThe parsing should be done as part of the poll loop"},
		{"id":"96b434858799c25b","fromNode":"6a5e75190ad0c3a1","fromSide":"right","toNode":"1056644817197069","toSide":"left"},
		{"id":"8ec9f793719dc918","fromNode":"1056644817197069","fromSide":"right","toNode":"359680b1fa8c1bac","toSide":"left"},
		{"id":"60ecc8019eef8f61","fromNode":"1056644817197069","fromSide":"left","toNode":"6a5e75190ad0c3a1","toSide":"right","label":"Create a Request using the raw request ->\n<- Return Response object"},
		{"id":"142836e4a32c540b","fromNode":"359680b1fa8c1bac","fromSide":"left","toNode":"1056644817197069","toSide":"right","label":"Ask for CGI of a path ->\n<- Return an fd for the content"},
		{"id":"3179ad84661289a7","fromNode":"1056644817197069","fromSide":"bottom","toNode":"7030fb2be992c307","toSide":"top"},
		{"id":"f42b2fa5d4d6e8e6","fromNode":"7030fb2be992c307","fromSide":"top","toNode":"1056644817197069","toSide":"bottom","label":"Request a file or dir listing ->\n<- Return an fd"},
		{"id":"883cdd82ffe7f181","fromNode":"6e9d8415dc547c2d","fromSide":"right","toNode":"6a5e75190ad0c3a1","toSide":"left"},
		{"id":"fd2638b978efcba6","fromNode":"2ad02c6a646a8021","fromSide":"top","toNode":"7030fb2be992c307","toSide":"bottom"},
		{"id":"425f8ecaa6fcd5b6","fromNode":"f7783e0a9eb791d2","fromSide":"right","toNode":"e2202cc847dfb53f","toSide":"left"}
	]
}